/*!
 * keml v3.2.1 - Enhance HTML with custom attributes for clean, server-driven interactivity.
 *
 * Docs:  https://thealjey.github.io/keml/
 * Repo:  https://github.com/thealjey/keml/
 * NPM:   https://www.npmjs.com/package/keml/
 *
 * Licensed under the MIT License. See LICENSE file for details.
 */
"use strict";(()=>{var m=e=>{let t=[],r=e.length,n=0,o=-1;for(;n<r;++n)e[n]===" "?o!==-1&&(t.push(e.slice(o,n)),o=-1):o===-1&&(o=n);return o!==-1&&t.push(e.slice(o,n)),t};var W=e=>{let t=Array.from(e.attributes),r=t.length;for(let n=0,o,i,s,c,a,l;n<r;++n){for(i=t[n],s=i.name,c=i.value,l=s.substring(2),o=0;o<r&&(a=t[o],a.name!==l);++o)a=void 0;s.startsWith("x-")?a?(i.value=a.value,a.value=c):(e.removeAttributeNode(i),e.setAttribute("d-"+l,""),e.setAttribute(l,c)):s.startsWith("d-")&&(a&&(e.setAttribute("x-"+l,a.value),e.removeAttributeNode(a)),e.removeAttributeNode(i))}},Q=e=>{e.hasAttribute("state")||(W(e),e.setAttribute("state",""))},N=e=>{let t=e.getAttributeNode("state");t&&(e.removeAttributeNode(t),W(e))};var R=(e,t,r)=>{if(t.nodeName==r.nodeName){if(t.nodeValue!=r.nodeValue&&(t.nodeValue=r.nodeValue),t.value!=r.value&&(t.value=r.value),t.checked!=r.checked&&(t.checked=r.checked),t instanceof Element){N(t);let n=t.attributes,o=n.length,i,s,c,a;for(;o--;)s=n[o],r.hasAttribute(s.name)||t.removeAttributeNode(s);for(n=r.attributes,o=0,i=n.length;o<i;++o)s=n[o],c=s.name,a=s.value,(s=t.getAttributeNode(c))?s.value!=a&&(s.value=a):t.setAttribute(c,a);M(t,Array.from(r.childNodes))}}else e.replaceChild(r,t)},V=(e,t)=>{let r=e.parentNode,n=t.length;if(n){let o=0,i;for(;o<n&&(i=t[o],!(i.nodeName==e.nodeName&&i.getAttribute?.("key")==e.getAttribute("key")));++o)i=void 0;i?(o&&e.before.apply(e,t.slice(0,o)),++o<n&&e.after.apply(e,t.slice(o)),R(r,e,i)):(n>1&&e.after.apply(e,t.slice(1)),R(r,e,t[0]))}else r.removeChild(e)},M=(e,t)=>{let r=e.childNodes,n=t.length,o=r.length,i=0,s,c,a;for(;i<n;++i){for(s=t[i],c=i,a=void 0;c<o&&(a=r[c],!(s.nodeName==a.nodeName&&s.getAttribute?.("key")==a.getAttribute?.("key")));++c)a=void 0;a?(c!==i&&e.insertBefore(a,r[i]),R(e,r[i],s)):i<o++?e.insertBefore(s,r[i]):e.appendChild(s)}for(;o>n;)e.removeChild(r[--o])};var b=new Set,h=new Set,E=new Set,x=new Set,g=new Set,A=new Set,B=[],L=[];var G=[],J=new Event("result"),D=[],w=!0,U=e=>D.push(e.target),v=()=>{w=!0},S=()=>{let e,t,r,n,o,i,s,c,a,l,u,d,p,f;for(;e=B.pop();)e.reset?.();for(;e=L.pop();)e.removeAttribute("on");for(;r=D.pop();){if(i=r.responseXML,e=r.s,o=void 0,(e.o=r.status>399)?(n=e.getAttributeNode("error"))&&(o=m(n.value)):(n=e.getAttributeNode("result"))&&(o=m(n.value)),o){u=!1,c=i?Array.from(i.body.childNodes):G,f=[];for(t of g)if(o.includes(t.getAttribute("render"))){if(u)for(s=[],a=0,l=c.length;a<l;++a)s.push(c[a].cloneNode(!0));else s=c;f.push(t,s),u=!0}for(;s=f.pop();)t=f.pop(),(n=t.getAttributeNode("position"))?(d=n.value,d==="after"?t.after.apply(t,s):d==="append"?t.append.apply(t,s):d==="before"?t.before.apply(t,s):d==="prepend"?t.prepend.apply(t,s):d==="replaceWith"?V(t,s):M(t,s)):M(t,s)}e.r=!1,w=!0,e.o||e.dispatchEvent(J)}if(w){w=!1,o=[];for(e of h)e.checkValidity&&(n=e.getAttributeNode("if:invalid"))&&!e.checkValidity()&&o.push.apply(o,m(n.value)),(e instanceof HTMLInputElement?e.type==="checkbox"?e.checked:e.value:(e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement)&&e.value)&&(n=e.getAttributeNode("if:value"))&&o.push.apply(o,m(n.value)),(n=e.getAttributeNode("if:intersects"))&&(p=e.getBoundingClientRect(),p.bottom>-1&&p.right>-1&&p.left<=innerWidth&&p.top<=innerHeight&&o.push.apply(o,m(n.value))),e.r&&(n=e.getAttributeNode("if:loading"))&&o.push.apply(o,m(n.value)),e.o&&(n=e.getAttributeNode("if:error"))&&o.push.apply(o,m(n.value));for(e of A)o.includes(e.getAttribute("if"))?Q(e):N(e)}requestAnimationFrame(S)};var Y=new Event("reveal"),ee=new Event("conceal"),te=e=>{let t=e.length;for(let r=0,n;r<t;++r)n=e[r],n.isIntersecting&&n.target.dispatchEvent(Y)},ne=e=>{let t=e.length;for(let r=0,n;r<t;++r)n=e[r],n.isIntersecting||n.target.dispatchEvent(ee)},H=new IntersectionObserver(te),C=new IntersectionObserver(ne),T=new IntersectionObserver(v);var oe=new Event("navigate"),k=()=>{for(let e of x)e.dispatchEvent(oe)};var X=document.createElement("form"),P=Object.create(null),y=(e,t)=>{if(e)for(let r of e)typeof r[1]=="string"&&t.searchParams.append(r[0],r[1])},O=e=>{if(clearTimeout(e.n),e.n=void 0,!e.checkValidity||e.checkValidity()){e.hasAttribute("once")&&L.push(e);let t,r,n,o="",i="GET";(t=e.getAttributeNode("get"))?o=t.value:(t=e.getAttributeNode("post"))?(o=t.value,i="POST"):(t=e.getAttributeNode("put"))?(o=t.value,i="PUT"):(t=e.getAttributeNode("delete"))?(o=t.value,i="DELETE"):((t=e.getAttributeNode("href"))||(t=e.getAttributeNode("action"))||(t=e.getAttributeNode("src")))&&(o=t.value),(t=e.getAttributeNode("method"))&&(i=t.value.toUpperCase());let s=new URL(o,e.baseURI),c=s.pathname,a=Array.from(c);r=a.length;for(let d=!1,p;r--;)if(p=c[r],p==="/")if(d){a.push("/");break}else a.pop();else if(p==="."){if(d)break;a.pop()}else d=!0;s.pathname=a.join("");let l;e instanceof HTMLFormElement?l=new FormData(e):e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement?(X.replaceChildren(e.cloneNode(!0)),l=new FormData(X)):(t=e.getAttributeNode("name"))&&(n=t.value,(t=e.getAttributeNode("value"))&&(l=new FormData,l.set(n,t.value)));let u=e.getAttribute("redirect");if(u==="pushState")y(l,s),history.pushState(P,"",s),k();else if(u==="replaceState")y(l,s),history.replaceState(P,"",s),k();else if(u==="assign")y(l,s),location.assign(s);else if(u==="replace")y(l,s),location.replace(s);else{let d=new XMLHttpRequest,p=e.attributes,f=p.length;for(i!=="POST"&&(y(l,s),l=void 0),d.responseType="document",d.withCredentials=e.hasAttribute("credentials"),d.s=e,d.onloadend=U,d.open(i,s),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),r=0;r<f;++r)t=p[r],n=t.name,n.startsWith("h-")&&d.setRequestHeader(n.substring(2),t.value);e.o=!1,e.r=!0,v(),d.send(l)}}};var F=e=>{let t=e.target;if(t instanceof Element){let r=e.type,n=t,o,i=`on:${r}`;for(;n&&!(o=n.getAttributeNode(i));)n=n.parentElement;if(n&&o){let s=m(o.value);if(s.length){if(o=n.getAttributeNode(`event:${r}`)){let c=o.value.split(","),a=c.length;for(let l=0,u;l<a;++l)if(u=c[l].split("="),r=u[0]?.trim(),r&&e[r]+""!==(u[1]?.trim()??"true"))return}e.preventDefault();for(n of b)s.includes(n.getAttribute("on"))&&((o=n.getAttributeNode("throttle"))?n.n??=setTimeout(O,+o.value,n):(o=n.getAttributeNode("debounce"))?(clearTimeout(n.n),n.n=setTimeout(O,+o.value,n)):O(n));for(n of E)s.includes(n.getAttribute("reset"))&&B.push(n)}}}};var j=[],q={i:{e(e,t){t==="on:navigate"?x.add(e):t==="on:reveal"?H.observe(e):t==="on:conceal"&&C.observe(e),j.includes(t)||(j.push(t),document.addEventListener(t.substring(3),F,!0))},t(e,t){t==="on:navigate"?x.delete(e):t==="on:reveal"?H.unobserve(e):t==="on:conceal"&&C.unobserve(e)}},a:{e(e,t){h.add(e),t==="if:intersects"&&T.observe(e)},t(e,t){h.delete(e),t==="if:intersects"&&T.unobserve(e)}},on:{e(e){b.add(e)},t(e){b.delete(e)}},if:{e(e){A.add(e)},t(e){A.delete(e)}},reset:{e(e){E.add(e)},t(e){E.delete(e)}},render:{e(e){g.add(e)},t(e){g.delete(e)}},autofocus:{e(e){try{let t=e.value.length;e.focus(),e.setSelectionRange(t,t)}catch{}},t(){}}},z=e=>{b.delete(e),A.delete(e),x.delete(e),g.delete(e),E.delete(e),h.delete(e),C.unobserve(e),T.unobserve(e),H.unobserve(e)},I=e=>e.startsWith("on:")?q.i:e.startsWith("if:")?q.a:q[e];var K=3e4,_=(e,t)=>{let r=Array.from(e),n,o,i,s,c,a;for(;n=r.pop();)if(n instanceof Element){if(t)for(c=n.attributes,s=0,i=c.length;s<i;++s)a=c[s].name,I(a)?.e(n,a);else z(n);if(o=n.childNodes,i=o.length,i<=K)r.push.apply(r,o);else for(s=0;s<i;)r.push.apply(r,Array.prototype.slice.call(o,s,s+=K))}};var $=e=>{let t=e.length;for(let r=0,n,o,i,s;r<t;++r)n=e[r],o=n.attributeName,i=n.target,_(n.removedNodes,!1),_(n.addedNodes,!0),o&&i instanceof Element&&(s=I(o),s&&(i.hasAttribute(o)?n.oldValue==null&&s.e(i,o):n.oldValue!=null&&s.t(i,o)));v()};var Z=()=>{try{document.cookie=`tzo=${new Date().getTimezoneOffset()};Path=/;SameSite=lax;Max-Age=31536000`}catch{}_(document.childNodes,!0),new MutationObserver($).observe(document,{attributeOldValue:!0,attributes:!0,childList:!0,subtree:!0}),document.addEventListener("change",v,!0),document.addEventListener("input",v,!0),document.addEventListener("reset",v,!0),window.addEventListener("popstate",k,!0),requestAnimationFrame(S)};document.addEventListener("DOMContentLoaded",Z,!0);})();
