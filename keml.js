/*!
 * keml v3.2.5 - Enhance HTML with custom attributes for clean, server-driven interactivity.
 *
 * Docs:  https://thealjey.github.io/keml/
 * Repo:  https://github.com/thealjey/keml/
 * NPM:   https://www.npmjs.com/package/keml/
 *
 * Licensed under the MIT License. See LICENSE file for details.
 */
"use strict";(()=>{var m=e=>{let t=[],r=e.length,n=0,o=-1;for(;n<r;++n)e.charCodeAt(n)===32?o!==-1&&(t.push(e.slice(o,n)),o=-1):o===-1&&(o=n);return o!==-1&&t.push(e.slice(o,n)),t};var D=e=>{let t=Array.from(e.attributes),r=t.length;for(let n=0,o,a,s,c,i,l;n<r;++n){for(a=t[n],s=a.name,c=a.value,l=s.slice(2),o=0;o<r&&(i=t[o],i.name!==l);++o)i=void 0;s.startsWith("x-")?i?(a.value=i.value,i.value=c):(e.removeAttributeNode(a),e.setAttribute("d-"+l,""),e.setAttribute(l,c)):s.startsWith("d-")&&(i&&(e.setAttribute("x-"+l,i.value),e.removeAttributeNode(i)),e.removeAttributeNode(a))}},X=e=>{e.hasAttribute("state")||(D(e),e.setAttribute("state",""))},L=e=>{let t=e.getAttributeNode("state");t&&(e.removeAttributeNode(t),D(e))};var q=(e,t,r)=>{if(t.nodeName==r.nodeName){if(t.nodeValue!=r.nodeValue&&(t.nodeValue=r.nodeValue),t.value!=r.value&&(t.value=r.value),t.checked!=r.checked&&(t.checked=r.checked),t instanceof Element){L(t);let n=t.attributes,o=n.length,a,s,c,i;for(;o--;)s=n[o],r.hasAttribute(s.name)||t.removeAttributeNode(s);for(n=r.attributes,o=0,a=n.length;o<a;++o)s=n[o],c=s.name,i=s.value,(s=t.getAttributeNode(c))?s.value!=i&&(s.value=i):t.setAttribute(c,i);N(t,Array.from(r.childNodes))}}else e.replaceChild(r,t)},U=(e,t)=>{let r=e.parentNode,n=t.length;if(n){let o=0,a;for(;o<n&&(a=t[o],!(a.nodeName==e.nodeName&&a.getAttribute?.("key")==e.getAttribute("key")));++o)a=void 0;a?(o&&e.before.apply(e,t.slice(0,o)),++o<n&&e.after.apply(e,t.slice(o)),q(r,e,a)):(n>1&&e.after.apply(e,t.slice(1)),q(r,e,t[0]))}else r.removeChild(e)},N=(e,t)=>{let r=e.childNodes,n=t.length,o=r.length,a=0,s,c,i;for(;a<n;++a){for(s=t[a],c=a,i=void 0;c<o&&(i=r[c],!(s.nodeName==i.nodeName&&s.getAttribute?.("key")==i.getAttribute?.("key")));++c)i=void 0;i?(c!==a&&e.insertBefore(i,r[a]),q(e,r[a],s)):a<o++?e.insertBefore(s,r[a]):e.appendChild(s)}for(;o>n;)e.removeChild(r[--o])};var h=new Set,E=new Set,x=new Set,g=new Set,A=new Set,k=new Set,w=[],C=[];var ee=[],te=new Event("result"),P=[],H=!0,y,F=e=>P.push(e.target),v=()=>{H=!0},j=e=>{y=e},W=()=>{let e,t,r,n,o,a,s,c,i,l,u,p,d,f;for(;e=w.pop();)e.reset?.();for(;e=C.pop();)e.removeAttribute("on");for(;r=P.pop();){if(a=r.responseXML,e=r.s,o=void 0,(e.o=r.status>399)?(n=e.getAttributeNode("error"))&&(o=m(n.value)):(n=e.getAttributeNode("result"))&&(o=m(n.value)),o){u=!1,c=a?Array.from(a.body.childNodes):ee,f=[];for(t of A)if(o.includes(t.getAttribute("render"))){if(u)for(s=[],i=0,l=c.length;i<l;++i)s.push(c[i].cloneNode(!0));else s=c;f.push(t,s),u=!0}for(;s=f.pop();)t=f.pop(),(n=t.getAttributeNode("position"))?(p=n.value,p==="after"?t.after.apply(t,s):p==="append"?t.append.apply(t,s):p==="before"?t.before.apply(t,s):p==="prepend"?t.prepend.apply(t,s):p==="replaceWith"?U(t,s):N(t,s)):N(t,s)}e.r=!1,H=!0,e.o||e.dispatchEvent(te)}if(H){H=!1,o=[];for(e of E)e.checkValidity&&(n=e.getAttributeNode("if:invalid"))&&!e.checkValidity()&&o.push.apply(o,m(n.value)),(e instanceof HTMLInputElement?e.type==="checkbox"?e.checked:e.value:(e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement)&&e.value)&&(n=e.getAttributeNode("if:value"))&&o.push.apply(o,m(n.value)),(n=e.getAttributeNode("if:intersects"))&&(d=e.getBoundingClientRect(),d.bottom>-1&&d.right>-1&&d.left<=innerWidth&&d.top<=innerHeight&&o.push.apply(o,m(n.value))),e.r&&(n=e.getAttributeNode("if:loading"))&&o.push.apply(o,m(n.value)),e.o&&(n=e.getAttributeNode("if:error"))&&o.push.apply(o,m(n.value));for(e of k)o.includes(e.getAttribute("if"))?X(e):L(e)}if(y){try{l=y.value.length,y.focus(),y.setSelectionRange(l,l)}catch{}y=void 0}requestAnimationFrame(W)};var ne=new Event("reveal"),oe=new Event("conceal"),re=e=>{let t=e.length;for(let r=0,n;r<t;++r)n=e[r],n.isIntersecting&&n.target.dispatchEvent(ne)},se=e=>{let t=e.length;for(let r=0,n;r<t;++r)n=e[r],n.isIntersecting||n.target.dispatchEvent(oe)},T=new IntersectionObserver(re),O=new IntersectionObserver(se),I=new IntersectionObserver(v);var ae=new Event("navigate"),_=()=>{for(let e of g)e.dispatchEvent(ae)};var K=document.createElement("form"),z=Object.create(null),B=(e,t)=>{if(e)for(let r of e)typeof r[1]=="string"&&t.searchParams.append(r[0],r[1])},R=e=>{if(clearTimeout(e.n),e.n=void 0,!e.checkValidity||e.checkValidity()){e.hasAttribute("once")&&C.push(e);let t,r,n,o="",a="GET";(t=e.getAttributeNode("get"))?o=t.value:(t=e.getAttributeNode("post"))?(o=t.value,a="POST"):(t=e.getAttributeNode("put"))?(o=t.value,a="PUT"):(t=e.getAttributeNode("delete"))?(o=t.value,a="DELETE"):((t=e.getAttributeNode("href"))||(t=e.getAttributeNode("action"))||(t=e.getAttributeNode("src")))&&(o=t.value),(t=e.getAttributeNode("method"))&&(a=t.value.toUpperCase());let s=new URL(o,e.baseURI),c=s.pathname,i,l,u,p=r=c.length;for(;r--&&c.charCodeAt(r)===47;);if(r!==-1){for(i=r-p+1;r--&&(l=c.charCodeAt(r),l!==47);)if(l===46){u=!0;break}u?i<0&&(s.pathname=c.slice(0,i)):i===0?s.pathname=c+"/":i<-1&&(s.pathname=c.slice(0,i+1))}let d;e instanceof HTMLFormElement?d=new FormData(e):e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement?(K.replaceChildren(e.cloneNode(!0)),d=new FormData(K)):(t=e.getAttributeNode("name"))&&(n=t.value,(t=e.getAttributeNode("value"))&&(d=new FormData,d.set(n,t.value)));let f=e.getAttribute("redirect");if(f==="pushState")B(d,s),history.pushState(z,"",s),_();else if(f==="replaceState")B(d,s),history.replaceState(z,"",s),_();else if(f==="assign")B(d,s),location.assign(s);else if(f==="replace")B(d,s),location.replace(s);else{let b=new XMLHttpRequest,V=e.attributes;for(a!=="POST"&&(B(d,s),d=void 0),b.responseType="document",b.withCredentials=e.hasAttribute("credentials"),b.s=e,b.onloadend=F,b.open(a,s),b.setRequestHeader("X-Requested-With","XMLHttpRequest"),r=0,p=V.length;r<p;++r)t=V[r],n=t.name,n.startsWith("h-")&&b.setRequestHeader(n.slice(2),t.value);e.o=!1,e.r=!0,v(),b.send(d)}}};var $=e=>{let t=e.target;if(t instanceof Element){let r=e.type,n=t,o,a=`on:${r}`;for(;n&&!(o=n.getAttributeNode(a));)n=n.parentElement;if(n&&o){let s=m(o.value);if(s.length){if(o=n.getAttributeNode(`event:${r}`)){let c=o.value.split(","),i=c.length;for(let l=0,u,p;l<i;++l)if(u=c[l],p=u.indexOf("="),p===-1){if(r=u.trim(),r&&!e[r])return}else if(r=u.slice(0,p).trim(),r&&e[r]+""!==u.slice(p+1).trim())return}e.preventDefault();for(n of h)s.includes(n.getAttribute("on"))&&((o=n.getAttributeNode("throttle"))?n.n??=setTimeout(R,+o.value,n):(o=n.getAttributeNode("debounce"))?(clearTimeout(n.n),n.n=setTimeout(R,+o.value,n)):R(n));for(n of x)s.includes(n.getAttribute("reset"))&&w.push(n)}}}};var G=[],Q={a:{e(e,t){t==="on:navigate"?g.add(e):t==="on:reveal"?T.observe(e):t==="on:conceal"&&O.observe(e),G.includes(t)||(G.push(t),document.addEventListener(t.slice(3),$,!0))},t(e,t){t==="on:navigate"?g.delete(e):t==="on:reveal"?T.unobserve(e):t==="on:conceal"&&O.unobserve(e)}},i:{e(e,t){E.add(e),t==="if:intersects"&&I.observe(e)},t(e,t){E.delete(e),t==="if:intersects"&&I.unobserve(e)}},on:{e(e){h.add(e)},t(e){h.delete(e)}},if:{e(e){k.add(e)},t(e){k.delete(e)}},reset:{e(e){x.add(e)},t(e){x.delete(e)}},render:{e(e){A.add(e)},t(e){A.delete(e)}},autofocus:{e:j,t(){}}},J=e=>{h.delete(e),k.delete(e),g.delete(e),A.delete(e),x.delete(e),E.delete(e),O.unobserve(e),I.unobserve(e),T.unobserve(e)},S=e=>e.startsWith("on:")?Q.a:e.startsWith("if:")?Q.i:Q[e];var M=(e,t)=>{let r=e.length;for(let n=0,o,a,s,c,i,l,u;n<r;++n)if(c=e[n],c instanceof Element){a=document.createTreeWalker(c,NodeFilter.SHOW_ELEMENT);do if(i=a.currentNode,t)for(o=0,u=i.attributes,l=u.length;o<l;++o)s=u[o].name,S(s)?.e(i,s);else J(i);while(a.nextNode())}};var Y=e=>{let t=e.length;for(let r=0,n,o,a,s;r<t;++r)n=e[r],o=n.attributeName,a=n.target,M(n.removedNodes,!1),M(n.addedNodes,!0),o&&a instanceof Element&&(s=S(o),s&&(a.hasAttribute(o)?n.oldValue==null&&s.e(a,o):n.oldValue!=null&&s.t(a,o)));v()};var Z=()=>{try{document.cookie=`tzo=${new Date().getTimezoneOffset()};Path=/;SameSite=lax;Max-Age=31536000`}catch{}M(document.childNodes,!0),new MutationObserver(Y).observe(document,{attributeOldValue:!0,attributes:!0,childList:!0,subtree:!0}),document.addEventListener("change",v,!0),document.addEventListener("input",v,!0),document.addEventListener("reset",v,!0),window.addEventListener("popstate",_,!0),requestAnimationFrame(W)};document.addEventListener("DOMContentLoaded",Z,!0);})();
